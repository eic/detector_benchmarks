rule beamline_sim:
    input:
        macro="{test}GPS.mac",
    output:
        "/scratch/EIC/G4out/beamline/{test}Test{tag}.edm4hep.root",
    log:
        "/scratch/EIC/G4out/beamline/{test}Test{tag}.edm4hep.root.log",
    shell:
        """
            exec npsim \
            --runType run \
            --enableG4GPS \
            --macroFile {input.macro} \
            --compactFile $DETECTOR_PATH/epic_ip6_extended.xml \
            --outputFile {output} \
        """

rule beamline_analysis:
    input:
        data="/scratch/EIC/G4out/beamline/{test}Test{tag}.edm4hep.root",
        script="{test}Analysis.C",
    output:
        "/scratch/EIC/ReconOut/beamline/{test}TestAnalysis{tag}.root"
    log:
        "/scratch/EIC/ReconOut/beamline/{test}TestAnalysis{tag}.root.log"
    params:
        xml=os.getenv("DETECTOR_PATH")+"/epic_ip6_extended.xml",
    shell:
        """
            root -l -b -q 'analysis.C("{input.data}", "{output}", "{params.xml}")'
        """

