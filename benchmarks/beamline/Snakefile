rule beamline_sim:
    input:
        macro="beamGPS.mac",
    output:
        "/scratch/EIC/G4out/beamline/beamlineTest.edm4hep.root",
    log:
        "/scratch/EIC/G4out/beamline/beamlineTest.edm4hep.root.log",
    shell:
        """
            exec npsim \
            --runType run \
            --enableG4GPS \
            --macroFile {input.macro} \
            --compactFile $DETECTOR_PATH/epic_ip6_extended.xml \
            --outputFile {output} \
        """

rule beamline_analysis:
    input:
        "/scratch/EIC/G4out/beamline/beamlineTest.edm4hep.root",
    output:
        "/scratch/EIC/ReconOut/beamline/beamlineTestAnalysis.root"
    log:
        "/scratch/EIC/ReconOut/beamline/beamlineTestAnalysis.root.log"
    params:
        xml=os.getenv("DETECTOR_PATH")+"/epic_ip6_extended.xml",
    shell:
        """
            root -l -b -q 'analysis.C("{input}", "{output}", "{params.xml}")'
        """
