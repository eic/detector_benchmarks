rule lowq2_tensor_recon:
    output:
        "tensors.eicrecon.tree.edm4eic.root",
    log:
        "tensors.eicrecon.tree.edm4eic.root.log",
    shell:  
        """
        eicrecon root://dtn-eic.jlab.org//work/eic2/EPIC/RECO/24.08.1/epic_craterlake/SIDIS/pythia6-eic/1.0.0/10x100/q2_0to1/pythia_ep_noradcor_10x100_q2_0.000000001_1.0_run6.ab.0001.eicrecon.tree.edm4eic.root -Ppodio:output_file={output} \
        -Ppodio:output_collections=TaggerTrackerFeatureTensor,TaggerTrackerTargetTensor \
        -Pjana:nevents=1000
        """


rule lowq2_reconstruction_training:
    input:
        data="tensors.eicrecon.tree.edm4eic.root",
        script="TaggerRegression.py",
    output:
        "TaggerRegressionTest.onnx",
    shell:
        """
        python {input.script} --input {input.data} --outModelFile {output}
        """

rule lowq2_reconstruction_inference:
    input:
        data="tensors.eicrecon.tree.edm4eic.root",
        model="TaggerRegressionTest.onnx",
    output:
        "TaggerInference.eicrecon.tree.edm4eic.root",
    shell:
        """
        eicrecon {input.data} -Ppodio:output_file={output}
        -Ptagger:inference_model={input.model} 
        -Pjana:nevents=1000
        -PLOWQ2:TaggerTrackerTransportationInference:modelPath={input.model}
        """