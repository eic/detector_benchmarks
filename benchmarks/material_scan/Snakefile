rule material_scan_fetch_script:
    output:
      "material_scan.py",
    shell: """
curl -L --output {output} https://github.com/eic/epic/raw/main/scripts/subdetector_tests/material_scan.py
"""

rule material_scan:
    input:
        script="material_scan.py",
    output:
        "results/material_scan/{DETECTOR_CONFIG}/material_scan.png",
        "results/material_scan/{DETECTOR_CONFIG}/material_scan_agg.csv",
        "results/material_scan/{DETECTOR_CONFIG}/material_scan_details.pdf",
    log:
        "results/material_scan/{DETECTOR_CONFIG}/material_scan.log",
    shadow: "full" # avoid putting calibrations/fieldmaps to results
    shell: """
cd results/material_scan/{wildcards.DETECTOR_CONFIG}
python ../../../{input.script} $DETECTOR_PATH/{wildcards.DETECTOR_CONFIG}.xml
"""
