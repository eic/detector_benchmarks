import os

DETECTOR_PATH = os.environ["DETECTOR_PATH"]


rule nhcal_acceptance_simulate:
    output:
        "sim_output/nhcal_acceptance/sim_epic_backward_hcal_only_E{energy}GeV.emd4hep.root",
    params:
        N_EVENTS=1000,
        SEED=0,
    shell:
        """
set -m
exec npsim \
    --compactFile {DETECTOR_PATH}/epic_backward_hcal_only.xml \
    --numberOfEvents {params.N_EVENTS} \
    --random.seed {params.SEED} \
    --enableGun \
    -v WARNING \
    --gun.particle "pi-" \
    --gun.thetaMin "120*degree" \
    --gun.thetaMax "180*degree" \
    --gun.distribution uniform \
    --gun.energy "{wildcards.energy}*GeV" \
    --outputFile {output}
"""

rule nhcal_acceptance_analysis:
    input:
        sim="sim_output/sim_epic_backward_hcal_only_E{energy}GeV.emd4hep.root",
        script="benchmarks/nhcal_acceptance/scripts/nhcal_acceptance_analysis.cxx",
    output:
        "results/nhcal_acceptance_analysis_E{energy}GeV.pdf",
    shell:
        """
    root -l -b -q '{input.script}("{input.sim}","{output}")'
"""